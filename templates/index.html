<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Bitcoin Trading Analysis</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <!-- CSS for beauty -->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
    <!-- Styling for pop-up for legal purposes-->
    <style>
        /* Style the button */
        button {
            color: white;
            background-color: #000;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }

        /* Styling for the pop-up content */
        .popup-content {
            color: white;
        }

        /* Style the pop-up overlay */
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            align-items: center;
            justify-content: center;
            z-index: 1;
        }

        /* Style the pop-up box */
        .popup-box {
            background: #000;
            padding: 20px;
            border-radius: 5px;
            max-width: 600px;
            text-align: left;
            opacity: 1;
            /* Set opacity to 100% */
        }

        /* Style the close button */
        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
        }

        /* New styles for image containers */
        .image-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }

        .image-container img {
            width: 300px;
            height: 200px;
            margin: 10px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-md-12 jumbotron text-center">
                <h1>Bitcoin Trading Analysis Dashboard</h1>
                <p>Use the interactive charts below to explore the BTC dataset to make informed choices!</p>
                <!-- Button to trigger pop-up -->
                <button onclick="togglePopup()">TERMS & CONDITIONS</button>
            </div>
        </div>
        <div class="row">
            <div class="col-md-2">
                <div class="well">
                    <h5>Selected Date:</h5>
                    <input type="date" id="dateSelector" onchange="updateCharts()">
                </div>
            </div>
            <div class="row">
                <div class="col-md-4">
                    <a href="/volatility_chart" target="_blank">View Volatility Chart</a>
                    <div class="image-container">
                        <img src="https://png.pngtree.com/png-clipart/20230815/original/pngtree-conceptual-image-of-a-cryptocurrency-crisis-with-bitcoins-fluctuating-arrow-depicting-digital-currency-volatility-and-associated-risks-vector-picture-image_10775666.png"
                            alt="Volatility Chart">
                    </div>
                </div>
                <div class="col-md-4">
                    <a href="/correlation_heatmap" target="_blank">View Correlation Heatmap</a>
                    <div class="image-container">
                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS_SGYgh0YkcDTIg9B6b6kpuh3YDYT4F0qDrRz0axuJXesdJPOZkeLPpxoj6Je0StfSDIo&usqp=CAU"
                            alt="Correlation Heatmap">
                    </div>
                </div>
                <div class="col-md-4">
                    <a href="/box_plot" target="_blank">View Box Plot</a>
                    <div class="image-container">
                        <img src="https://cdn-icons-png.flaticon.com/512/6754/6754439.png" alt="Box Plot">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Pop-up overlay & box -->
    <div class="overlay" onclick="togglePopup()">
        <div class="popup-box" onclick="event.stopPropagation();">
            <!-- Close Button-->
            <span class="close-btn" onclick="togglePopup()">X</span>
            <!-- Text content for the pop-up -->
            <h2>Terms & Conditions</h2>
            <p class="popup-content">
                By reading the content here you understand that the information provided on this platform is for
                general informational purposes only and should not be considered as financial advice. We do not
                provide personalized financial, investment, or tax advice. The content is not intended to be a
                substitute for professional financial advice, diagnosis, or treatment. This is for educational
                purposes only, and we do not endorse or recommend any specific financial products, services, or
                strategies. Any reliance you place on this information is strictly at your own risk.
            </p>
        </div>
    </div>

    <!-- Include the necessary JavaScript libraries -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <!-- Include the BTC analysis JavaScript file -->
    <script src="{{ url_for('static', filename='btc_analysis.js') }}"></script>

    <!-- Additional script for pop-up functionality -->
    <script>
        // Function to toggle the pop-up display
        function togglePopup() {
            const overlay = document.querySelector('.overlay');
            overlay.style.display = overlay.style.display === 'flex' ? 'none' : 'flex';
        }

        // Function to fetch BTC data
        function fetchBTCData(selectedDate) {
            // Fetch data from Flask API
            fetch(`/api/btcdata?date=${selectedDate}`)
                .then(response => response.json())
                .then(data => {
                    // Process and use the data to create charts
                    createHistoricalChart(data.historicalClosePrices, selectedDate);
                    createBoxPlot(data.volumeData);
                    createCorrelationHeatmap(data.corrMatrix);
                    createVolatilityChart(data.volatilityData); // Adding volatility chart
                    displayAdditionalInfo(data.additionalInfo);
                })
                .catch(error => console.error("Error fetching BTC data:", error));
        }

        // Function to create a historical chart
        function createHistoricalChart(closePrices, selectedDate) {
            // Specific logic using the BTC data
            const trace = {
                x: closePrices.map(entry => entry.date),
                y: closePrices.map(entry => entry.price),
                type: "line"
            };

            const data = [trace];

            const layout = {
                title: `Historical BTC Prices on ${selectedDate}`,
                xaxis: { title: "Date" },
                yaxis: { title: "Close Price (USD)" }
            };

            Plotly.newPlot("historicalChart", data, layout);
        }

        // Function to create a box plot
        function createBoxPlot(volumeData) {
            const trace = {
                y: volumeData.map(entry => entry.Volume),
                type: "box"
            };

            const data = [trace];

            const layout = {
                title: "Box Plot of Bitcoin Trading Volume",
                xaxis: { title: "Volume" },
                yaxis: { title: "Value" }
            };

            Plotly.newPlot("boxPlot", data, layout);
        }

        // Function to create a correlation heatmap
        function createCorrelationHeatmap(corrMatrix) {
            const data = [{
                z: corrMatrix.values,
                x: corrMatrix.columns,
                y: corrMatrix.index,
                type: "heatmap",
                colorscale: 'RdBu'
            }];

            const layout = {
                title: "Correlation Heatmap",
                xaxis: { title: "Features" },
                yaxis: { title: "Features" }
            };

            Plotly.newPlot("heatmap", data, layout);
        }

        // Function to create a volatility chart
        function createVolatilityChart(volatilityData) {
            const trace = {
                x: volatilityData.map(entry => entry.date),
                y: volatilityData.map(entry => entry.volatility),
                type: "line"
            };

            const data = [trace];

            const layout = {
                title: "Volatility Chart",
                xaxis: { title: "Date" },
                yaxis: { title: "Volatility" }
            };

            Plotly.newPlot("volatilityChart", data, layout);
        }

        // Function to display additional information if needed
        function displayAdditionalInfo(additionalInfo) {
            // Specific logic using the additional information
            console.log("Additional Info:", additionalInfo);
        }

        // Function to update charts on date selection change
        function updateCharts() {
            // Date picker element with id "dateSelector"
            const selectedDate = document.getElementById("dateSelector").value;
            fetchBTCData(selectedDate);
        }

        // Initialize the date picker and fetch initial BTC data
        function init() {
            // Pick the date
            const datePicker = document.getElementById("dateSelector");

            // Set the default date to the current date
            datePicker.valueAsDate = new Date();

            // Add event listener to handle date selection change
            datePicker.addEventListener("change", updateCharts);

            // Fetch initial BTC data for the default date
            const defaultDate = datePicker.value; // Use the selected date
            fetchBTCData(defaultDate);
        }

        // Call the init function to initialize the date picker and fetch initial BTC data
        init();
    </script>
</body>

</html>
